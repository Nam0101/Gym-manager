var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},AccountLink;(function(n){function h(n,t){var i=a(n.accLinkRefreshEndPointUrl),r={url:i,requestType:"GET",onSuccess:t.onSuccess,onError:t.onError};v(r)}function s(n){var t=c(n);h(n,t)}function c(n){return{onSuccess:function(n){var e=sb_gt(),o=Math.floor(e/1e3)*1e3,f;sj_cook.set(r,u,o.toString(),!0,"/");t("Refresh Account Link info Success");i("onRefreshAccountLinkInfoResponse","success");f={IsTenantAllowAccountLink:n.IsTenantAllowAccountLink,HasLinkedAccount:n.HasLinkedAccount};n.AccountLinkUpdated&&(t("fire acclink:updated"),sj_evt.fire("acclink:updated",f));n.HasLinkedAccount&&n.IsTenantAllowAccountLink&&i("onRefreshAccountLinkInfoResponse","hasActiveLinkedAccount")},onError:function(f,e,o){var s=sb_gt(),h=Math.floor(s/1e3)*1e3,c=h-(n.refreshAccountLinkInfoTimeInSeconds-n.refreshAccountLinkInfoRetryTimeInSeconds)*1e3;sj_cook.set(r,u,c.toString(),!0,"/");t("Refresh Account Link info Fail");i("onRefreshAccountLinkInfoResponse","fail","reason",f,"statusCode",e.toString(),"responseText",o)}}}var r="ACLUSR",u="T",e="correlationId",o="acclink",f="";n.init=function(n){f=n.correlationId||(typeof _G!="undefined"&&_G.EventId?_G.EventId:"");i("init","loadJsModule");t("init account linking module",n);n.isAadAuthenticated?l(n.refreshAccountLinkInfoTimeInSeconds)&&(i("init","directflow"),t("start executeAccountLinkIntegration based on accLinkUserState cookie"),s(n)):(i("init","undirectflow"),t("no aad authenticated,attach executeAccountLinkIntegration to aad Signedin event"),sj_evt.bind("aad:signedin",function(){return s(n)},!0,null,!0));n.hasActiveLinkedAccount&&i("init","hasActiveLinkedAccount")};var l=function(n){var i=sj_cook.get(r,u),f,e;return!i||i===""?(t("no valid AccLinkUserStateLastFetchTimeVal found"),!0):(f=parseInt(i),e=sb_gt()-f,e>n*1e3)?(t("has passed timespanToRefreshInSeconds from last fetch",f,e),!0):(t("should not refresh account link info"),!1)},t=function(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t]},i=function(n,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];typeof Log!="undefined"&&Log&&Log.Log&&Log.Log.apply(Log,__spreadArray([o,n,t,!1,e,f],r,!1))},a=function(n){var t=n.indexOf("?")>=0?"&":"?";return n+t+e+"="+f},v=function(n){var a,u,f;if(n!=null){var e=n.timeout,o=n.onSuccess,i=n.onError,s=n.accessToken,h=n.url,c=n.body,v=n.tries,y=n.requestType,r=n.headers,t=sj_gx(),p=y||"GET",l=function(){return t.open(p,h,!0)};if(l(),h[0]!=="/"&&(t.withCredentials=!0),t.ontimeout=function(){return i&&i("timeout",504,null)},t.timeout=e==null?0:e,a=v||1,u=function(n,t,r){i!=null&&i(t,n,r)},s!=null&&t.setRequestHeader("Authorization","Bearer ".concat(s)),r)for(f in r)t.setRequestHeader(f,r[f]);t.onreadystatechange=function(){if(t.readyState===4)if(t.status===200){if(o!=null){var n=null;if(t.responseText!=null&&t.responseText!=="")try{n=JSON.parse(t.responseText)}catch(r){u(-1,"InvalidData",t.responseText);return}n&&n.Success?o(n):i("fedration not success",0,n)}}else--a>0?(t.abort(),l(),t.send(c)):u(t.status,"Ajax call failed with status ".concat(t.status,". No retries available."),t.responseText)};t.send(c)}}})(AccountLink||(AccountLink={}))